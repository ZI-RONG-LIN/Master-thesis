libname g"I:\2 USER\SAS匯出資料\HEALTH01\0528 有用急性藥的紀錄";

/*macro篩選出各檔有使用氣喘急性藥物的門診就醫紀錄，並合併檔案*/
%macro p1(f,l);
%do i= &f %to &l;
data OPDTO1&i.;set Tmp1.H_NHI_OPDTO&i._10;
if Drug_NO in (&AllDrugs);
key=compress(FEE_YM||APPL_TYPE||HOSP_ID||APPL_DATE||CASE_TYPE||SEQ_NO);
keep FEE_YM APPL_TYPE HOSP_ID APPL_DATE CASE_TYPE SEQ_NO Drug_NO key;
run;
proc sort data=OPDTO1&i.;by key;run;
data o1&i.;set OPDTO1&i.;
by key;
if last.key;
run;
%end;%mend;
%p1(10401,10412);
%p1(10301,10312);
%p1(10201,10212);
%p1(10101,10112);
%p1(10001,10012);
%p1(9901,9912);
%p1(9801,9812);
%p1(9701,9712);
%p1(9601,9612);
%p1(10501,10512);
%p1(10601,10612);

%macro p2(f,l);
%do i= &f %to &l;
data OPDTO2&i.;set Tmp1.H_NHI_OPDTO&i._20;
if Drug_NO in (&AllDrugs);
key=compress(FEE_YM||APPL_TYPE||HOSP_ID||APPL_DATE||CASE_TYPE||SEQ_NO);
keep FEE_YM APPL_TYPE HOSP_ID APPL_DATE CASE_TYPE SEQ_NO Drug_NO key;
run;
proc sort data=OPDTO2&i.;by key;run;
data o2&i.;set OPDTO2&i.;
by key;
if last.key;
run;
%end;%mend;
%p2(10401,10412);
%p2(10301,10312);
%p2(10201,10212);
%p2(10101,10112);
%p2(10001,10012);
%p2(9901,9912);
%p2(9801,9812);
%p2(9701,9712);
%p2(9601,9612);
%p2(10501,10512);
%p2(10601,10612);

%macro p3(f,l);
%do i= &f %to &l;
data OPDTO3&i.;set Tmp1.H_NHI_OPDTO&i._30;
if Drug_NO in (&AllDrugs);
key=compress(FEE_YM||APPL_TYPE||HOSP_ID||APPL_DATE||CASE_TYPE||SEQ_NO);
keep FEE_YM APPL_TYPE HOSP_ID APPL_DATE CASE_TYPE SEQ_NO Drug_NO key;
run;
proc sort data=OPDTO3&i.;by key;run;
data o3&i.;set OPDTO3&i.;
by key;
if last.key;
run;
%end;%mend;
%p3(10401,10412);
%p3(10301,10312);
%p3(10201,10212);
%p3(10101,10112);
%p3(10001,10012);
%p3(9901,9912);
%p3(9801,9812);
%p3(9701,9712);
%p3(9601,9612);
%p3(10501,10512);
%p3(10601,10612);

data g.f1;
set o19601 o19602 o19603 o19604 o19605 o19606 o19607 o19608 o19609 o19610 o19611 o19612
o19701 o19702 o19703 o19704 o19705 o19706 o19707 o19708 o19709 o19710 o19711 o19712
o19801 o19802 o19803 o19804 o19805 o19806 o19807 o19808 o19809 o19810 o19811 o19812
o19901 o19902 o19903 o19904 o19905 o19906 o19907 o19908 o19909 o19910 o19911 o19912
o110001 o110002 o110003 o110004 o110005 o110006 o110007 o110008 o110009 o110010 o110011 o110012
o110101 o110102 o110103 o110104 o110105 o110106 o110107 o110108 o110109 o110110 o110111 o110112
o110201 o110202 o110203 o110204 o110205 o110206 o110207 o110208 o110209 o110210 o110211 o110212
o110301 o110302 o110303 o110304 o110305 o110306 o110307 o110308 o110309 o110310 o110311 o110312
o110401 o110402 o110403 o110404 o110405 o110406 o110407 o110408 o110409 o110410 o110411 o110412
o110501 o110502 o110503 o110504 o110505 o110506 o110507 o110508 o110509 o110510 o110511 o110512
o110601 o110602 o110603 o110604 o110605 o110606 o110607 o110608 o110609 o110610 o110611 o110612;
run;

data g.f2;
set o29601 o29602 o29603 o29604 o29605 o29606 o29607 o29608 o29609 o29610 o29611 o29612
o29701 o29702 o29703 o29704 o29705 o29706 o29707  o29708 o29709 o29710 o29711 o29712
o29801 o29802 o29803 o29804 o29805 o29806 o29807  o29808 o29809 o29810 o29811 o29812
o29901 o29902 o29903 o29904 o29905 o29906 o29907  o29908 o29909 o29910 o29911 o29912
o210001 o210002 o210003 o210004 o210005 o210006 o210007  o210008 o210009 o210010 o210011 o210012
o210101 o210102 o210103 o210104 o210105 o210106 o210107  o210108 o210109 o210110 o210111 o210112
o210201 o210202 o210203 o210204 o210205 o210206 o210207  o210208 o210209 o210210 o210211 o210212
o210301 o210302 o210303 o210304 o210305 o210306 o210307  o210308 o210309 o210310 o210311 o210312
o210401 o210402 o210403 o210404 o210405 o210406 o210407  o210408 o210409 o210410 o210411 o210412
o210501 o210502 o210503 o210504 o210505 o210506 o210507  o210508 o210509 o210510 o210511 o210512
o210601 o210602 o210603 o210604 o210605 o210606 o210607  o210608 o210609 o210610 o210611 o210612;
run;

data g.f3;
set o39601 o39602 o39603 o39604 o39605 o39606 o39607 o39608 o39609 o39610 o39611 o39612
o39701 o39702 o39703 o39704 o39705 o39706 o39707 o39708 o39709 o39710 o39711 o39712
o39801 o39802 o39803 o39804 o39805 o39806 o39807 o39808 o39809 o39810 o39811 o39812
o39901 o399802 o39903 o39904 o39905 o39906 o39907 o39908 o39909 o39910 o39911 o39912
o310001 o3100802 o310003 o310004 o310005 o310006 o310007 o310008 o310009 o310010 o310011 o310012
o310101 o3101802 o310103 o310104 o310105 o310106 o310107 o310108 o310109 o310110 o310111 o310112
o310201 o3102802 o310203 o310204 o310205 o310206 o310207 o310208 o310209 o310210 o310211 o310212
o310301 o3103802 o310303 o310304 o310305 o310306 o310307 o310308 o310309 o310310 o310311 o310312
o310401 o3104802 o310403 o310404 o310405 o310406 o310407 o310408 o310409 o310410 o310411 o310412
o310501 o3105802 o310503 o310504 o310505 o310506 o310507 o310508 o310509 o310510 o310511 o310512
o310601 o3106802 o310603 o310604 o310605 o310606 o310607 o310608 o310609 o310610 o310611 o310612;
run;




